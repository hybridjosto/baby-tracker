<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Weekly Planner</title>
    <link rel="manifest" href="{{ base_path }}/static/manifest.json">
    <link rel="apple-touch-icon" href="{{ base_path }}/apple-touch-icon.png">
    <link
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700&display=swap"
      rel="stylesheet"
    >
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@400,0"
      rel="stylesheet"
    >
    <link rel="stylesheet" href="{{ base_path }}/static/styles.css">
    <script>
      (() => {
        const stored = localStorage.getItem("baby-tracker-theme");
        const prefersDark = window.matchMedia
          && window.matchMedia("(prefers-color-scheme: dark)").matches;
        const theme = stored || (prefersDark ? "dark" : "light");
        if (theme === "dark") {
          document.documentElement.classList.add("dark");
        }
      })();
    </script>
    <style>
      .page {
        max-width: 1200px;
        margin: 0 auto;
        padding: 22px 20px 40px;
        display: flex;
        flex-direction: column;
        gap: 18px;
      }
      .hero {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        flex-wrap: wrap;
      }
      .hero-title {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .hero-title .eyebrow {
        text-transform: uppercase;
        letter-spacing: 0.24em;
        font-size: 11px;
        font-weight: 600;
        color: var(--text-secondary);
      }
      .hero-title h1 {
        margin: 0;
        font-size: 28px;
      }
      .hero-title p {
        margin: 0;
        color: var(--text-secondary);
      }
      .nav-actions {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
      }
      .nav-icon {
        width: 40px;
        height: 40px;
      }
      .calendar-shell {
        background: var(--card-light);
        border-radius: 26px;
        border: 1px solid var(--border-light);
        box-shadow: var(--shadow-soft);
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }
      html.dark .calendar-shell {
        background: var(--card-dark);
        border-color: var(--border-dark);
      }
      .week-bar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        flex-wrap: wrap;
      }
      .week-range {
        font-size: 18px;
        font-weight: 600;
      }
      .week-actions {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
      }
      .week-actions button,
      .week-actions a {
        border: 1px solid var(--border-light);
        background: var(--surface-soft);
        color: var(--text-primary);
        border-radius: 999px;
        padding: 8px 14px;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }
      html.dark .week-actions button,
      html.dark .week-actions a {
        border-color: var(--border-dark);
        background: rgba(255, 255, 255, 0.08);
        color: #d3e4d7;
      }
      .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, minmax(0, 1fr));
        gap: 12px;
      }
      .calendar-day {
        background: var(--surface-soft);
        border-radius: 18px;
        padding: 12px 12px 14px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        min-height: 180px;
      }
      html.dark .calendar-day {
        background: rgba(255, 255, 255, 0.06);
      }
      .calendar-day-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      .calendar-day-label {
        font-size: 13px;
        font-weight: 600;
      }
      .calendar-day-date {
        font-size: 12px;
        color: var(--text-secondary);
      }
      .calendar-events {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .calendar-event {
        background: var(--card-light);
        border-radius: 14px;
        padding: 10px 12px;
        border: 1px solid var(--border-light);
        display: flex;
        flex-direction: column;
        gap: 6px;
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.06);
      }
      html.dark .calendar-event {
        background: rgba(26, 44, 32, 0.9);
        border-color: var(--border-dark);
      }
      .event-time {
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        color: var(--text-secondary);
      }
      .event-title {
        font-weight: 600;
        font-size: 14px;
      }
      .event-meta {
        font-size: 12px;
        color: var(--text-secondary);
      }
      .event-tag {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: rgba(19, 236, 91, 0.14);
        color: #0f1a12;
        border-radius: 999px;
        font-size: 11px;
        padding: 2px 8px;
        font-weight: 600;
      }
      html.dark .event-tag {
        color: #0f1a12;
      }
      .calendar-day.empty .calendar-events {
        opacity: 0.55;
        font-size: 12px;
        color: var(--text-secondary);
      }
      .prototype-note {
        font-size: 12px;
        color: var(--text-secondary);
      }
      @media (max-width: 1100px) {
        .calendar-grid {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }
      }
      @media (max-width: 680px) {
        .calendar-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body data-user="{{ user_slug }}" data-user-valid="{{ 'true' if user_valid else 'false' }}" data-page="calendar" data-base-path="{{ base_path }}">
    <main class="page">
      <header class="hero">
        <div class="hero-title">
          <span class="eyebrow">Weekly Planner</span>
          <h1>Find something to do</h1>
          <p>Keep track of children’s groups, meetups, and local family hub sessions.</p>
        </div>
        <div class="nav-actions">
          <a class="nav-icon" id="home-link" href="#" aria-label="Home" title="Home">
            <span class="material-symbols-outlined" aria-hidden="true">home</span>
          </a>
          <a class="nav-icon" id="log-link" href="#" aria-label="Event log" title="Event log">
            <span class="material-symbols-outlined" aria-hidden="true">format_list_bulleted</span>
          </a>
          <a class="nav-icon" id="timeline-link" href="#" aria-label="Timeline" title="Timeline">
            <span class="material-symbols-outlined" aria-hidden="true">timeline</span>
          </a>
          <a class="nav-icon" href="{{ base_path }}/settings" aria-label="Settings" title="Settings">
            <span class="material-symbols-outlined" aria-hidden="true">settings</span>
          </a>
          <button class="nav-icon" id="theme-toggle" type="button" aria-label="Switch to light mode">
            <span class="material-symbols-outlined" aria-hidden="true">light_mode</span>
          </button>
        </div>
      </header>

      <section class="calendar-shell">
        <div class="week-bar">
          <div>
            <div class="week-range" id="week-range">Week of --</div>
            <div class="prototype-note">Prototype view with sample events.</div>
          </div>
          <div class="week-actions">
            <button type="button" data-week-nav="prev">
              <span class="material-symbols-outlined" aria-hidden="true">chevron_left</span>
              Prev
            </button>
            <button type="button" data-week-nav="today">Today</button>
            <button type="button" data-week-nav="next">
              Next
              <span class="material-symbols-outlined" aria-hidden="true">chevron_right</span>
            </button>
            <a href="{{ base_path }}/calendar/add">
              <span class="material-symbols-outlined" aria-hidden="true">add</span>
              Add event
            </a>
          </div>
        </div>
        <div class="calendar-grid" id="calendar-days"></div>
      </section>
    </main>

    <script>
      (() => {
        const weekRangeEl = document.getElementById("week-range");
        const daysWrap = document.getElementById("calendar-days");
        const navButtons = document.querySelectorAll("[data-week-nav]");
        const dayLabelFmt = new Intl.DateTimeFormat(undefined, { weekday: "short" });
        const dayDateFmt = new Intl.DateTimeFormat(undefined, { day: "numeric", month: "short" });
        const rangeFmt = new Intl.DateTimeFormat(undefined, { day: "numeric", month: "short" });

        const startOfWeek = (value) => {
          const date = new Date(value);
          const day = date.getDay();
          const diff = (day + 6) % 7;
          date.setDate(date.getDate() - diff);
          date.setHours(0, 0, 0, 0);
          return date;
        };

        const toIsoDate = (date) => date.toISOString().slice(0, 10);

        const buildMockEvents = (weekStart) => {
          const events = [];
          const addEvent = (offset, title, time, location, category) => {
            const date = new Date(weekStart);
            date.setDate(weekStart.getDate() + offset);
            events.push({
              date: toIsoDate(date),
              title,
              time,
              location,
              category,
            });
          };
          addEvent(0, "Tiny Tots Playgroup", "09:30–11:00", "St. Mary’s Hall", "Group");
          addEvent(1, "Family Hub Drop-In", "13:00–15:00", "Meadow Family Hub", "Hub");
          addEvent(2, "Sensory Storytime", "10:00–11:00", "Library Annex", "Meetup");
          addEvent(4, "Baby Yoga", "09:15–10:00", "Willow Studio", "Group");
          addEvent(5, "Saturday Park Picnic", "11:00–13:00", "Riverside Park", "Meetup");
          return events;
        };

        let weekOffset = 0;

        const renderWeek = () => {
          const today = new Date();
          const weekStart = startOfWeek(new Date(today.getFullYear(), today.getMonth(), today.getDate() + weekOffset * 7));
          const weekEnd = new Date(weekStart);
          weekEnd.setDate(weekStart.getDate() + 6);
          weekRangeEl.textContent = `Week of ${rangeFmt.format(weekStart)} – ${rangeFmt.format(weekEnd)}`;

          const events = buildMockEvents(weekStart);
          daysWrap.innerHTML = "";

          for (let i = 0; i < 7; i += 1) {
            const dayDate = new Date(weekStart);
            dayDate.setDate(weekStart.getDate() + i);
            const dayIso = toIsoDate(dayDate);
            const dayEvents = events.filter((event) => event.date === dayIso);

            const section = document.createElement("section");
            section.className = "calendar-day";
            if (!dayEvents.length) {
              section.classList.add("empty");
            }

            section.innerHTML = `
              <div class="calendar-day-header">
                <div class="calendar-day-label">${dayLabelFmt.format(dayDate)}</div>
                <div class="calendar-day-date">${dayDateFmt.format(dayDate)}</div>
              </div>
              <div class="calendar-events">
                ${dayEvents.length ? "" : "<div>No sessions added yet.</div>"}
              </div>
            `;

            if (dayEvents.length) {
              const eventsWrap = section.querySelector(".calendar-events");
              dayEvents.forEach((event) => {
                const card = document.createElement("article");
                card.className = "calendar-event";
                card.innerHTML = `
                  <div class="event-time">${event.time}</div>
                  <div class="event-title">${event.title}</div>
                  <div class="event-meta">${event.location}</div>
                  <div class="event-tag">${event.category}</div>
                `;
                eventsWrap.appendChild(card);
              });
            }

            daysWrap.appendChild(section);
          }
        };

        navButtons.forEach((button) => {
          button.addEventListener("click", () => {
            const action = button.dataset.weekNav;
            if (action === "prev") {
              weekOffset -= 1;
            } else if (action === "next") {
              weekOffset += 1;
            } else {
              weekOffset = 0;
            }
            renderWeek();
          });
        });

        renderWeek();
      })();
    </script>
    <script src="{{ base_path }}/static/app.js"></script>
  </body>
</html>
